<html>
    <title>Sample Page</title>
    <head>
        <link rel="stylesheet" href="style2.css">
    </head>
    <body>
        <p><span id="matchCount">Matches: 0</span></p>
        <div id="cardsContainer" style="display:flex; flex-wrap:wrap; gap:20px;"></div>
    <script>
            window.onload = () => {
                const stored = JSON.parse(localStorage.getItem("flashcards"));
                if (!stored) return;

                let cards = [];
                for (let i = 0; i < stored.questions.length; i++) {
                    if (stored.questions[i] !== "" && stored.answers[i] !== "") {
                        cards.push({
                                    role: "q",              
                                    pair: i,
                                    type: stored.questions[i].type,
                                    content: stored.questions[i].content
                                });

                        cards.push({
                                    role: "a",
                                    pair: i,
                                    type: stored.answers[i].type,
                                    content: stored.answers[i].content
                                });

                    }
                }

                for (let i = cards.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [cards[i], cards[j]] = [cards[j], cards[i]];
                }

                const container = document.getElementById("cardsContainer");
                container.innerHTML = "";

                let openedCards = [];
                let lockBoard = false;
                matched = 0;

                cards.forEach(card => {
                    const div = document.createElement("div");
                    div.classList.add("flip-card");
                    div.dataset.type = card.type;
                    div.dataset.pair = card.pair;

                    let content;

                    if (card.type == "image") {
                        content = `<img src="${card.content}" style="width:100%; height:100%; object-fit:cover;">`;
                    } else {
                        content = `<p>${card.content}</p>`;
                    }

                    div.innerHTML = `
                        <div class="flip-card-inner">
                            <div class="flip-card-front">
                                <img src="component_images/card.png" style="width:100%; height:100%; object-fit:cover;">
                            </div>
                            <div class="flip-card-back">
                                <div class="back-text">
                                    ${content}
                                </div>
                            </div>
                        </div>
                    `;
                    
                    div.addEventListener("click", () => {
                        if (lockBoard) return;
                        if (div.classList.contains("matched")) return;
                        if (openedCards.includes(div)) return;

                        div.classList.add("flipped");
                        openedCards.push(div);

                        if (openedCards.length === 2) {
                            lockBoard = true;
                            const [c1, c2] = openedCards;

                            if (c1.dataset.pair === c2.dataset.pair ) {
                                c1.classList.add("matched");
                                c2.classList.add("matched");
                                matched ++;
                                updateMatchCount(matched,stored.questions.length);
                            } else {
                                setTimeout(() => {
                                    c1.classList.remove("flipped");
                                    c2.classList.remove("flipped");
                                }, 1000);
                            }

                            openedCards = [];
                            lockBoard = false;
                        }
                    });

                    container.appendChild(div);
                });


            };
           
             
            function updateMatchCount(matched,len) {
                document.getElementById('matchCount').textContent = "Matched Pairs: " + matched + " / " + (len);
                if (matched === len){
                    window.location.href = "final_message.html";
                }
                 
            }


</script>

    </body>
</html>