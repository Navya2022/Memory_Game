<!DOCTYPE html>
<html>
<head>
    <title>Display Input Data</title>
    <link rel="stylesheet" href="style1.css">
</head>
<body>


    <div id="inputContainer">
    <div class="qa-field">
        
    </div>
    </div>

    <button id="addBtn">+</button> 


<script>
    async function displayData() {
    let questions = [];
    let answers = [];

    const fields = document.querySelectorAll(".qa-field");

    // IndexedDB helpers (store blobs, return small key)
    const openDB = () => new Promise((resolve, reject) => {
        const req = indexedDB.open('memory-game-db', 1);
        req.onupgradeneeded = e => {
            const db = e.target.result;
            if (!db.objectStoreNames.contains('images')) db.createObjectStore('images');
        };
        req.onsuccess = e => resolve(e.target.result);
        req.onerror = e => reject(e.target.error);
    });

    async function saveImageToIDB(file) {
        if (!file) return null;
        const db = await openDB();
        return new Promise((resolve, reject) => {
            const tx = db.transaction('images', 'readwrite');
            const store = tx.objectStore('images');
            const key = 'img_' + Date.now() + '_' + Math.floor(Math.random() * 1e6);
            const putReq = store.put(file, key);
            putReq.onsuccess = () => resolve(key);
            putReq.onerror = e => reject(e.target.error);
        });
    }

    for (let field of fields) {

        const qRadio = field.querySelector('input[name^="qtype"]:checked');
        const qIsImage = qRadio?.value === "image";

        let qValue;
        if (qIsImage) {
            const file = field.querySelector(".question-image")?.files?.[0];
            const key = file ? await saveImageToIDB(file) : null;
            qValue = key ? `idb:${key}` : null;
        } else {
            qValue = field.querySelector(".question-input")?.value?.trim() || null;
        }

        const aRadio = field.querySelector('input[name^="atype"]:checked');
        const aIsImage = aRadio?.value === "image";

        let aValue;
        if (aIsImage) {
            const file = field.querySelector(".answer-image")?.files?.[0];
            const key = file ? await saveImageToIDB(file) : null;
            aValue = key ? `idb:${key}` : null;
        } else {
            aValue = field.querySelector(".answer-input")?.value?.trim() || null;
        }

        if (qValue && aValue) {
            questions.push({
                type: qIsImage ? "image" : "text",
                content: qValue
            });

            answers.push({
                type: aIsImage ? "image" : "text",
                content: aValue
            });
        }

    }

    sessionStorage.setItem("flashcards", JSON.stringify({ questions, answers }));
    if (questions.length === 0) {
        alert("Please add at least one complete question + answer pair before generating cards.");
        return;
    }

    // navigate to game page (do not delete the IndexedDB here — the game page needs it)
    window.location.href = "card_custom.html";
}

</script>
<script>
    function createQAField() {
    const div = document.createElement("div");
    div.classList.add("qa-field");

    const uniqueID = Date.now();

    div.innerHTML = `
        <div class="question-block">
            <label><b>Question</b></label><br>

            <label>Text <input type="radio" name="qtype-${uniqueID}" value="text" checked></label>
            <label>Image <input type="radio" name="qtype-${uniqueID}" value="image"></label>
            <div class="question-input-container">
                <input type="text" class="question-input" placeholder="Enter question">
            </div>
        </div>
        <br>

        <div class="answer-block">
            <label><b>Answer</b></label><br>

            <label>Text <input type="radio" name="atype-${uniqueID}" value="text" checked></label>
            <label>Image <input type="radio" name="atype-${uniqueID}" value="image"></label>
            <div class="answer-input-container">
                <input type="text" class="answer-input" placeholder="Enter answer">
            </div>
        </div>

        <button class="deleteBtn">−</button>
    `;

    div.querySelector(".deleteBtn").addEventListener("click", () => div.remove());

    div.querySelectorAll(`input[name="qtype-${uniqueID}"]`).forEach(radio => {
        radio.addEventListener("change", e => {
            const container = div.querySelector(".question-input-container");
            if (e.target.value === "text") {
                container.innerHTML = `<input type="text" class="question-input" placeholder="Enter question">`;
            } else {
                container.innerHTML = `<input type="file" accept="image/*" class="question-image">`;
            }
        });
    });

    div.querySelectorAll(`input[name="atype-${uniqueID}"]`).forEach(radio => {
        radio.addEventListener("change", e => {
            const container = div.querySelector(".answer-input-container");
            if (e.target.value === "text") {
                container.innerHTML = `<input type="text" class="answer-input" placeholder="Enter answer">`;
            } else {
                container.innerHTML = `<input type="file" accept="image/*" class="answer-image">`;
            }
        });
    });

    return div;
}
    
    
    // Add button — append a new QA field
    document.getElementById("addBtn").addEventListener("click", () => {
        document.getElementById("inputContainer").appendChild(createQAField());
    });
    
    // Create an initial QA field immediately
    document.getElementById("inputContainer").appendChild(createQAField());
    
    // (individual delete listeners are attached inside createQAField)
    // keep any per-field type radio logic handled inside each created field
</script>

<button id ="generate_button" onclick="displayData()">Generate Cards</button>

</body>
</html>
